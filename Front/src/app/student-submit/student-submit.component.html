<div class="container">
  <div class="form-card">
    <div class="card-header">
      <h2 style="color: white"><b>FICHE DE VALIDATION DE THEME</b></h2>
      <p style="color: white">
        <b
          >Remplissez tous les champs requis pour soumettre votre proposition de
          th√®me de m√©moire</b
        >
      </p>

      <!-- Barre de progression -->
      <div class="progress-container" style="margin-top: 1rem">
        <div
          class="progress-bar"
          style="
            background: rgba(255, 255, 255, 0.2);
            height: 6px;
            border-radius: 3px;
          "
        >
          <div
            class="progress-fill"
            [style.width.%]="getCompletionPercentage()"
            style="
              background: #4caf50;
              height: 100%;
              border-radius: 3px;
              transition: width 0.3s ease;
            "
          ></div>
        </div>
        <small style="color: white; margin-top: 0.5rem; display: block">
          {{ getCompletionPercentage() }}% compl√©t√©
        </small>
      </div>
    </div>

    <div class="card-content">
      <!-- IMPORTANT: Ajout de [formGroup] et (ngSubmit) -->
      <form
        class="proposal-form"
        [formGroup]="studentForm"
        (ngSubmit)="onSubmit()"
      >
        <!-- Contact -->
        <div class="form-group">
          <label for="contact" class="form-label">Contact *</label>
          <input
            id="contact"
            type="text"
            class="form-input"
            placeholder="Votre contact (t√©l√©phone, email, etc.)"
            formControlName="contact"
          />
          <div
            class="error-message"
            *ngIf="
              studentForm.get('contact')?.invalid &&
              studentForm.get('contact')?.touched
            "
          >
            Le contact est requis
          </div>
        </div>

        <!-- Nom et Pr√©noms -->
        <div class="form-group">
          <label for="fullName" class="form-label">Nom et Pr√©noms *</label>
          <input
            id="fullName"
            type="text"
            class="form-input"
            placeholder="Jean Dupont"
            formControlName="fullName"
          />
          <div
            class="error-message"
            *ngIf="
              studentForm.get('fullName')?.invalid &&
              studentForm.get('fullName')?.touched
            "
          >
            Le nom et pr√©noms sont requis
          </div>
        </div>

        <!-- Libell√© du th√®me -->
        <div class="form-group">
          <label for="themeTitle" class="form-label">Libell√© du th√®me *</label>
          <input
            id="themeTitle"
            type="text"
            class="form-input"
            placeholder="Titre de votre th√®me de m√©moire"
            formControlName="themeTitle"
          />
          <div
            class="error-message"
            *ngIf="
              studentForm.get('themeTitle')?.invalid &&
              studentForm.get('themeTitle')?.touched
            "
          >
            Le libell√© du th√®me est requis
          </div>
        </div>

        <!-- Probl√©matique -->
        <div class="form-group">
          <label for="problematic" class="form-label">Probl√©matique *</label>
          <textarea
            id="problematic"
            class="form-textarea"
            placeholder="D√©crivez la probl√©matique que vous souhaitez aborder..."
            formControlName="problematic"
            rows="4"
          ></textarea>
          <div
            class="error-message"
            *ngIf="
              studentForm.get('problematic')?.invalid &&
              studentForm.get('problematic')?.touched
            "
          >
            La probl√©matique est requise
          </div>
        </div>

        <!-- Objectif g√©n√©ral -->
        <div class="form-group">
          <label for="generalObjective" class="form-label"
            >Objectif g√©n√©ral *</label
          >
          <textarea
            id="generalObjective"
            class="form-textarea"
            placeholder="D√©crivez l'objectif principal de votre recherche..."
            formControlName="generalObjective"
            rows="3"
          ></textarea>
          <div
            class="error-message"
            *ngIf="
              studentForm.get('generalObjective')?.invalid &&
              studentForm.get('generalObjective')?.touched
            "
          >
            L'objectif g√©n√©ral est requis
          </div>
        </div>

        <!-- Objectifs sp√©cifiques -->
        <div class="form-group">
          <label for="specificObjectives" class="form-label"
            >Objectifs sp√©cifiques *</label
          >
          <textarea
            id="specificObjectives"
            class="form-textarea"
            placeholder="Listez vos objectifs sp√©cifiques (un par ligne ou s√©par√©s par des points)..."
            formControlName="specificObjectives"
            rows="4"
          ></textarea>
          <div
            class="error-message"
            *ngIf="
              studentForm.get('specificObjectives')?.invalid &&
              studentForm.get('specificObjectives')?.touched
            "
          >
            Les objectifs sp√©cifiques sont requis
          </div>
        </div>

        <!-- R√©sultats attendus -->
        <div class="form-group">
          <label for="expectedResults" class="form-label"
            >Les r√©sultats attendus *</label
          >
          <textarea
            id="expectedResults"
            class="form-textarea"
            placeholder="D√©crivez les r√©sultats que vous esp√©rez obtenir..."
            formControlName="expectedResults"
            rows="4"
          ></textarea>
          <div
            class="error-message"
            *ngIf="
              studentForm.get('expectedResults')?.invalid &&
              studentForm.get('expectedResults')?.touched
            "
          >
            Les r√©sultats attendus sont requis
          </div>
        </div>

        <!-- Debug: Affichage du statut du formulaire -->
        <div
          style="
            background: #f0f0f0;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
          "
        >
          <p><strong>Debug Info:</strong></p>
          <p>Formulaire valide: {{ studentForm.valid ? "OUI" : "NON" }}</p>
          <p>Pourcentage: {{ getCompletionPercentage() }}%</p>
          <p>Statut des champs:</p>
          <ul>
            <li>
              Contact: {{ studentForm.get("contact")?.valid ? "‚úÖ" : "‚ùå" }} ({{
                studentForm.get("contact")?.value || "vide"
              }})
            </li>
            <li>
              Nom: {{ studentForm.get("fullName")?.valid ? "‚úÖ" : "‚ùå" }} ({{
                studentForm.get("fullName")?.value || "vide"
              }})
            </li>
            <li>
              Th√®me:
              {{ studentForm.get("themeTitle")?.valid ? "‚úÖ" : "‚ùå" }} ({{
                studentForm.get("themeTitle")?.value || "vide"
              }})
            </li>
            <li>
              Probl√©matique:
              {{ studentForm.get("problematic")?.valid ? "‚úÖ" : "‚ùå" }} ({{
                studentForm.get("problematic")?.value || "vide"
              }})
            </li>
            <li>
              Objectif g√©n√©ral:
              {{ studentForm.get("generalObjective")?.valid ? "‚úÖ" : "‚ùå" }} ({{
                studentForm.get("generalObjective")?.value || "vide"
              }})
            </li>
            <li>
              Objectifs sp√©cifiques:
              {{
                studentForm.get("specificObjectives")?.valid ? "‚úÖ" : "‚ùå"
              }}
              ({{ studentForm.get("specificObjectives")?.value || "vide" }})
            </li>
            <li>
              R√©sultats:
              {{ studentForm.get("expectedResults")?.valid ? "‚úÖ" : "‚ùå" }} ({{
                studentForm.get("expectedResults")?.value || "vide"
              }})
            </li>
          </ul>
        </div>

        <!-- Submit Buttons -->
        <div class="form-actions">
          <button type="button" class="cancel-button" (click)="onCancel()">
            Annuler
          </button>
          <button
            type="submit"
            class="submit-button"
            [disabled]="!isFormValid() || isSubmitting"
          >
            <svg
              *ngIf="!isSubmitting"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="m22 2-7 20-4-9-9-4Z" />
              <path d="M22 2 11 13" />
            </svg>
            <span *ngIf="isSubmitting">Envoi en cours...</span>
            <span *ngIf="!isSubmitting">Soumettre</span>
          </button>
        </div>
      </form>

      <!-- Affichage des donn√©es soumises -->
      <div
        class="values-display"
        *ngIf="showValues && submittedData"
        style="
          margin-top: 2rem;
          padding: 1.5rem;
          background: #f8f9fa;
          border-radius: 8px;
        "
      >
        <h3 style="color: #333; margin-bottom: 1rem">üìã Donn√©es soumises :</h3>

        <div style="margin-bottom: 1rem">
          <strong>Contact :</strong> {{ submittedData.contact }}
        </div>
        <div style="margin-bottom: 1rem">
          <strong>Nom et Pr√©noms :</strong> {{ submittedData.fullName }}
        </div>
        <div style="margin-bottom: 1rem">
          <strong>Libell√© du th√®me :</strong> {{ submittedData.themeTitle }}
        </div>
        <div style="margin-bottom: 1rem">
          <strong>Probl√©matique :</strong><br />
          <p
            style="
              margin: 0.5rem 0;
              padding: 0.5rem;
              background: white;
              border-radius: 4px;
            "
          >
            {{ submittedData.problematic }}
          </p>
        </div>
        <div style="margin-bottom: 1rem">
          <strong>Objectif g√©n√©ral :</strong><br />
          <p
            style="
              margin: 0.5rem 0;
              padding: 0.5rem;
              background: white;
              border-radius: 4px;
            "
          >
            {{ submittedData.generalObjective }}
          </p>
        </div>
        <div style="margin-bottom: 1rem">
          <strong>Objectifs sp√©cifiques :</strong><br />
          <p
            style="
              margin: 0.5rem 0;
              padding: 0.5rem;
              background: white;
              border-radius: 4px;
              white-space: pre-line;
            "
          >
            {{ submittedData.specificObjectives }}
          </p>
        </div>
        <div style="margin-bottom: 1rem">
          <strong>R√©sultats attendus :</strong><br />
          <p
            style="
              margin: 0.5rem 0;
              padding: 0.5rem;
              background: white;
              border-radius: 4px;
            "
          >
            {{ submittedData.expectedResults }}
          </p>
        </div>

        <div style="margin-top: 1.5rem">
          <button
            type="button"
            (click)="hideValues()"
            style="
              background: #6c757d;
              color: white;
              border: none;
              padding: 0.5rem 1rem;
              border-radius: 4px;
              margin-right: 0.5rem;
              cursor: pointer;
            "
          >
            Masquer
          </button>
          <button
            type="button"
            (click)="resetForm()"
            style="
              background: #007bff;
              color: white;
              border: none;
              padding: 0.5rem 1rem;
              border-radius: 4px;
              cursor: pointer;
            "
          >
            Nouveau formulaire
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
